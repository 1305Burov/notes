(()=>{"use strict";const t=()=>fetch("http://localhost:1234/users").then((t=>t.json()));t().then((t=>{console.log(t)}));const e=t,n=t=>fetch(`http://localhost:1234/users/${t}/posts`).then((t=>t.json())).catch((t=>{console.error(t)})),s=t=>{n(t).then((t=>{content.innerHTML="";let e=t.map((t=>{const e=t.updateTime?t.updateTime:t.date;return`\n                <div class="post" id="${t.id}">\n                    <h2 class="post__title"><span>${t.title}</span></h2>\n                    <p class="post__text">\n                        ${t.text}\n                    </p>\n                    <div class="post__box">\n                        <div class="post__actions actions">\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/899/899796.png" alt="read post" class="actions__icon actions__read"></button>\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/1159/1159633.png" alt="edit post" class="actions__icon actions__edit"></button>\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="delete post" class="actions__icon actions__delete"></button>\n                        </div>\n                        <div class="post__date">\n                            ${e}\n                        </div>\n                    </div>\n                </div>\n            `})).join("");e+='<div class="post post_create" id="newPost"></div>',content.insertAdjacentHTML("afterbegin",e)}))},o=t=>fetch(`http://localhost:1234/posts/${t}`).then((t=>t.json())).catch((t=>{console.error(t)})),a=()=>{content.addEventListener("click",(t=>{const e=document.getElementById("overlay"),n=document.getElementById("read"),s=n.noteTitle,a=n.noteText;if(t.target.classList.contains("post_create")&&document.getElementById("newNote").classList.remove("hidden"),t.target.classList.contains("actions__read")){const i=t.target.closest(".post").id;e.classList.remove("hidden"),n.classList.remove("hidden"),o(i).then((t=>{n.dataset.idPost=i,s.value=t.title,a.value=t.text,s.disabled=!0,a.disabled=!0}))}if(t.target.classList.contains("actions__edit")){const i=t.target.closest(".post").id;e.classList.remove("hidden"),n.classList.remove("hidden"),o(i).then((t=>{n.dataset.idPost=i,s.value=t.title,a.value=t.text,s.disabled=!1,a.disabled=!1}))}if(t.target.classList.contains("actions__delete")){const n=document.getElementById("delete-form"),s=t.target.closest(".post").id;n.classList.remove("hidden"),e.classList.remove("hidden"),n.dataset.idPost=s}}))},i=(t,e)=>{t.style.borderColor="red",t.closest("label").querySelector(".error__text").textContent=`${e}`},c=t=>{const e=t.classList.contains("noteText")||t.classList.contains("noteTitle")?/^\S*/:/^[A-Za-z0-9]\S*[^/\;!@#$%^&*()_]$/;if(t.value.trim().length>=3){if(e.test(t.value.trim()))return!0;i(t,"Invalid value")}else i(t,"At least 3 symbols");t.addEventListener("focus",(()=>{t.closest("label").querySelector(".error__text").textContent="",t.style.borderColor=""}),{once:!0})},d=()=>{const t=JSON.parse(localStorage.getItem("User")).id,e=document.getElementById("overlay"),n=document.getElementById("newNote"),o=document.getElementById("read"),a=document.getElementById("delete-form"),i=document.getElementById("cancelNote"),d=document.getElementById("cancel-delete"),l=document.getElementById("close-read");function r(t,n){t.reset(),t.classList.add(n);let s=setTimeout((()=>{t.classList.add("hidden"),e.classList.add("hidden"),t.classList.remove(n),clearTimeout(s)}),500)}n.addEventListener("submit",(e=>{const n=e.target,o=n.title,a=n.text;e.preventDefault();let i=c(o),d=c(a);i&&d&&(((t,e,n)=>fetch("http://localhost:1234/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,title:e,text:n,date:(new Date).toLocaleString().slice(0,-3)})}).catch((t=>{console.error(t)})))(t,o.value,a.value).then((()=>{s(t)})),r(n,"form-out"))})),o.addEventListener("submit",(e=>{e.preventDefault();const n=e.target,o=n.noteTitle,a=n.noteText;((t,e,n)=>fetch(`http://localhost:1234/posts/${t}`,{method:"PATCH",body:JSON.stringify({title:e,text:n,updateTime:`${(new Date).toLocaleString().slice(0,-3)} UPD`}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((t=>t.json())).catch((t=>{console.error(t)})))(n.dataset.idPost,o.value,a.value).then((()=>{o.disabled=!o.disabled,a.disabled=!a.disabled,s(t)}))})),a.addEventListener("submit",(e=>{const n=e.target,o=n.dataset.idPost;var a;e.preventDefault(),(a=o,fetch(`http://localhost:1234/posts/${a}`,{method:"DELETE"}).catch((t=>{console.error(t)}))).then((()=>{s(t),r(n,"hideModal")}))})),i.addEventListener("click",(t=>{r(t.target.closest("form"),"form-out")})),d.addEventListener("click",(t=>{r(t.target.closest("form"),"hideModal")})),l.addEventListener("click",(t=>{r(t.target.closest("form"),"slide-top")}))},l=t=>{const e=document.getElementById("searchInput");e.addEventListener("input",(s=>{n(t).then((t=>{let n=t.filter((t=>t.title.toLowerCase().trim().includes(e.value)));if(0===n.length)content.innerHTML="Here are not such notes...";else{content.innerHTML="";let t=n.map((t=>{const e=t.updateTime?t.updateTime:t.date;return`\n                        <div class="post" id="${t.id}">\n                            <h2 class="post__title"><span>${t.title}</span></h2>\n                            <p class="post__text">\n                                ${t.text}\n                            </p>\n                            <div class="post__box">\n                                <div class="post__actions actions">\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/899/899796.png" alt="read post" class="actions__icon actions__read"></button>\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/1159/1159633.png" alt="edit post" class="actions__icon actions__edit"></button>\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="delete post" class="actions__icon actions__delete"></button>\n                                </div>\n                                <div class="post__date">\n                                    ${e}\n                                </div>\n                            </div>\n                        </div>\n                    `})).join("");t+='<div class="post post_create" id="newPost"></div>',content.insertAdjacentHTML("afterbegin",t)}}))}))},r=()=>{const t=JSON.parse(localStorage.getItem("User"))||"{}";if(t.id){const e=document.getElementById("user"),n=document.getElementById("content"),o=e.children[1];document.getElementById("search").classList.remove("hidden"),form.classList.add("hidden"),n.classList.remove("hidden"),e.classList.remove("hidden"),o.textContent=t.login,document.getElementById("logout").addEventListener("click",(()=>{localStorage.removeItem("User"),location.reload()})),s(t.id),d(),a(),l(t.id)}},m=(t,n)=>{let s=!1;e().then((e=>{for(let o in e)if(t===e[o].login&&n===e[o].password){s=!0,localStorage.setItem("User",JSON.stringify(e[o])),r();break}s||alert("Invalid login or password!")}))};!function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"np-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),document.getElementById("form").addEventListener("click",(t=>{const e=t.target,n=document.getElementById("loginInput"),s=document.getElementById("passwordInput");t.preventDefault();const o=c(n),a=c(s);var i,d;o&&a&&("reg"===e.id&&(i=n.value,d=s.value,fetch("http://localhost:1234/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:i,password:d})}).then((t=>t.json())).then((t=>{m(i,d)}))),"login"===e.id&&m(n.value.trim(),s.value.trim()))})),r()})();