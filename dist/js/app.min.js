(()=>{"use strict";const t=t=>fetch(`http://my-json-server.typicode.com/1305burov/notes/users/${t}/posts`).then((t=>t.json())).catch((t=>{console.error(t)})),e=e=>{t(e).then((t=>{content.innerHTML="";let e=t.map((t=>{const e=t.updateTime?t.updateTime:t.date;return`\n                <div class="post" id="${t.id}">\n                    <h2 class="post__title"><span>${t.title}</span></h2>\n                    <p class="post__text">\n                        ${t.text}\n                    </p>\n                    <div class="post__box">\n                        <div class="post__actions actions">\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/899/899796.png" alt="read post" class="actions__icon actions__read"></button>\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/1159/1159633.png" alt="edit post" class="actions__icon actions__edit"></button>\n                        <button><img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="delete post" class="actions__icon actions__delete"></button>\n                        </div>\n                        <div class="post__date">\n                            ${e}\n                        </div>\n                    </div>\n                </div>\n            `})).join("");e+='<div class="post post_create" id="newPost"></div>',content.insertAdjacentHTML("afterbegin",e)}))},n=t=>fetch(`http://my-json-server.typicode.com/1305burov/notes/posts/${t}`).then((t=>t.json())).catch((t=>{console.error(t)})),s=()=>{content.addEventListener("click",(t=>{const e=document.getElementById("overlay"),s=document.getElementById("read"),o=s.noteTitle,i=s.noteText;if(t.target.classList.contains("post_create")&&document.getElementById("newNote").classList.remove("hidden"),t.target.classList.contains("actions__read")){const c=t.target.closest(".post").id;e.classList.remove("hidden"),s.classList.remove("hidden"),n(c).then((t=>{s.dataset.idPost=c,o.value=t.title,i.value=t.text,o.disabled=!0,i.disabled=!0}))}if(t.target.classList.contains("actions__edit")){const c=t.target.closest(".post").id;e.classList.remove("hidden"),s.classList.remove("hidden"),n(c).then((t=>{s.dataset.idPost=c,o.value=t.title,i.value=t.text,o.disabled=!1,i.disabled=!1}))}if(t.target.classList.contains("actions__delete")){const n=document.getElementById("delete-form"),s=t.target.closest(".post").id;n.classList.remove("hidden"),e.classList.remove("hidden"),n.dataset.idPost=s}}))},o=(t,e)=>{t.style.borderColor="red",t.closest("label").querySelector(".error__text").textContent=`${e}`},i=t=>{const e=t.classList.contains("noteText")||t.classList.contains("noteTitle")?/^\S*/:/^[A-Za-z0-9]\S*[^/\;!@#$%^&*()_]$/;if(t.value.trim().length>=3){if(e.test(t.value.trim()))return!0;o(t,"Invalid value")}else o(t,"At least 3 symbols");t.addEventListener("focus",(()=>{t.closest("label").querySelector(".error__text").textContent="",t.style.borderColor=""}),{once:!0})},c=()=>{const t=JSON.parse(localStorage.getItem("User")).id,n=document.getElementById("overlay"),s=document.getElementById("newNote"),o=document.getElementById("read"),c=document.getElementById("delete-form"),a=document.getElementById("cancelNote"),d=document.getElementById("cancel-delete"),l=document.getElementById("close-read");function r(t,e){t.reset(),t.classList.add(e);let s=setTimeout((()=>{t.classList.add("hidden"),n.classList.add("hidden"),t.classList.remove(e),clearTimeout(s)}),500)}s.addEventListener("submit",(n=>{const s=n.target,o=s.title,c=s.text;n.preventDefault();let a=i(o),d=i(c);a&&d&&(((t,e,n)=>fetch("http://my-json-server.typicode.com/1305burov/notes/posts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,title:e,text:n,date:(new Date).toLocaleString().slice(0,-3)})}).catch((t=>{console.error(t)})))(t,o.value,c.value).then((()=>{e(t)})),r(s,"form-out"))})),o.addEventListener("submit",(n=>{n.preventDefault();const s=n.target,o=s.noteTitle,i=s.noteText;((t,e,n)=>fetch(`http://my-json-server.typicode.com/1305burov/notes/posts/${t}`,{method:"PATCH",body:JSON.stringify({title:e,text:n,updateTime:`${(new Date).toLocaleString().slice(0,-3)} UPD`}),headers:{"Content-type":"application/json; charset=UTF-8"}}).then((t=>t.json())).catch((t=>{console.error(t)})))(s.dataset.idPost,o.value,i.value).then((()=>{o.disabled=!o.disabled,i.disabled=!i.disabled,e(t)}))})),c.addEventListener("submit",(n=>{const s=n.target,o=s.dataset.idPost;var i;n.preventDefault(),(i=o,fetch(`http://my-json-server.typicode.com/1305burov/notes/posts/${i}`,{method:"DELETE"}).catch((t=>{console.error(t)}))).then((()=>{e(t),r(s,"hideModal")}))})),a.addEventListener("click",(t=>{r(t.target.closest("form"),"form-out")})),d.addEventListener("click",(t=>{r(t.target.closest("form"),"hideModal")})),l.addEventListener("click",(t=>{r(t.target.closest("form"),"slide-top")}))},a=e=>{const n=document.getElementById("searchInput");n.addEventListener("input",(s=>{t(e).then((t=>{let e=t.filter((t=>t.title.toLowerCase().trim().includes(n.value)));if(0===e.length)content.innerHTML="Here are not such notes...";else{content.innerHTML="";let t=e.map((t=>{const e=t.updateTime?t.updateTime:t.date;return`\n                        <div class="post" id="${t.id}">\n                            <h2 class="post__title"><span>${t.title}</span></h2>\n                            <p class="post__text">\n                                ${t.text}\n                            </p>\n                            <div class="post__box">\n                                <div class="post__actions actions">\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/899/899796.png" alt="read post" class="actions__icon actions__read"></button>\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/1159/1159633.png" alt="edit post" class="actions__icon actions__edit"></button>\n                                <button><img src="https://cdn-icons-png.flaticon.com/512/6861/6861362.png" alt="delete post" class="actions__icon actions__delete"></button>\n                                </div>\n                                <div class="post__date">\n                                    ${e}\n                                </div>\n                            </div>\n                        </div>\n                    `})).join("");t+='<div class="post post_create" id="newPost"></div>',content.insertAdjacentHTML("afterbegin",t)}}))}))},d=()=>{const t=JSON.parse(localStorage.getItem("User"))||"{}";if(t.id){const n=document.getElementById("user"),o=document.getElementById("content"),i=n.children[1];document.getElementById("search").classList.remove("hidden"),form.classList.add("hidden"),o.classList.remove("hidden"),n.classList.remove("hidden"),i.textContent=t.login,document.getElementById("logout").addEventListener("click",(()=>{localStorage.removeItem("User"),location.reload()})),e(t.id),c(),s(),a(t.id)}},l=(t,e)=>{let n=!1;fetch("http://my-json-server.typicode.com/1305burov/notes/users").then((t=>t.json())).catch((t=>{console.error(t)})).then((s=>{for(let o in s)if(t===s[o].login&&e===s[o].password){n=!0,localStorage.setItem("User",JSON.stringify(s[o])),d();break}n||alert("Invalid login or password!")}))};!function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"np-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}(),document.getElementById("form").addEventListener("click",(t=>{const e=t.target,n=document.getElementById("loginInput"),s=document.getElementById("passwordInput");t.preventDefault();const o=i(n),c=i(s);var a,d;o&&c&&("reg"===e.id&&(a=n.value,d=s.value,fetch("http://my-json-server.typicode.com/1305burov/notes/users",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:a,password:d})}).then((t=>t.json())).then((()=>{l(a,d)})).catch((t=>{console.error(t)}))),"login"===e.id&&l(n.value.trim(),s.value.trim()))})),d()})();